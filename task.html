<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>小狗的任务</title>
  <style>
    body {
      font-family: 'Times New Roman', serif;
      margin: 0;
      padding: 0;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      height: 100vh;
      background: linear-gradient(135deg, #ffccd5, #f7a7bb, #d1c4e9);
      color: #fff5ee;
      overflow: hidden;
      perspective: 1200px;
    }
    h1 {
      margin-bottom: 20px;
      font-size: 2em;
      text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.3);
    }
    #card-container {
      position: relative;
      width: 900px;
      height: 600px;
      background: linear-gradient(45deg, #ffe4e1, #f8b0c3);
      border-radius: 16px;
      box-shadow: 0 15px 40px rgba(0, 0, 0, 0.3);
      overflow: visible;
      user-select: none;
    }
    .card {
      position: absolute;
      width: 120px;
      height: 210px;
      border: 3px solid #ffd700;
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      text-align: center;
      cursor: pointer;
      transition: transform 0.6s;
      transform-style: preserve-3d;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
      z-index: 1;
    }
    .card-front, .card-back {
      position: absolute;
      width: 100%;
      height: 100%;
      backface-visibility: hidden;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 7px;
      padding: 10px;
      box-sizing: border-box;
    }
    .card-front {
      background: url('6.webp') center/cover;
      color: #4b2e39;
      font-size: 14px;
      text-shadow: 1px 1px 1px rgba(255, 255, 255, 0.5);
      border: 2px solid #c71585;
      transform: rotateY(0deg);
    }
    .card-back {
      background: url('2.jpeg') center/cover;
      color: #fff5ee;
      font-size: 18px;
      border: 2px solid #ff69b4;
      transform: rotateY(180deg);
    }
    .flipped {
      transform: rotateY(180deg);
      z-index: 2;
    }
    #status {
      margin-top: 20px;
      font-size: 18px;
      text-shadow: 1px 1px 1px rgba(0, 0, 0, 0.3);
    }
    .button-group {
      margin-top: 15px;
      display: flex;
      gap: 10px;
    }
    button {
      padding: 10px 20px;
      border: none;
      border-radius: 5px;
      font-size: 16px;
      cursor: pointer;
      transition: background-color 0.3s;
    }
    #reset-button {
      background-color: #ffd700;
      color: #4b2e39;
      display: none;
    }
    #reset-button:hover {
      background-color: #e6b800;
    }
    #challenge-button {
      background-color: #ff69b4;
      color: #fff;
    }
    #challenge-button:hover {
      background-color: #e055a0;
    }
    #mild-button {
      background-color: #87cefa;
      color: #fff;
    }
    #mild-button:hover {
      background-color: #5ab0dd;
    }
    button.active {
      outline: 2px solid #fff;
      box-shadow: 0 0 8px #fff;
    }

    button.disabled {
      opacity: 0.5;
      pointer-events: none;
    }
    #password-modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: 9999;
    }
    .modal-overlay {
      position: absolute;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.6);
    }

    .modal-content {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: #fff0f5;
      color: #4b2e39;
      padding: 20px 30px;
      border-radius: 10px;
      box-shadow: 0 0 20px rgba(255, 192, 203, 0.5);
      text-align: center;
      width: 300px;
    }

    .modal-content input {
      width: 90%;
      padding: 8px;
      margin-top: 10px;
      border-radius: 5px;
      border: 1px solid #ffb6c1;
      font-size: 16px;
    }

    .modal-buttons {
      margin-top: 15px;
      display: flex;
      justify-content: space-around;
    }

    .modal-buttons button {
      padding: 6px 16px;
      border: none;
      border-radius: 5px;
      background: #ff69b4;
      color: #fff;
      cursor: pointer;
      transition: background 0.3s;
    }

    .modal-buttons button:hover {
      background: #e055a0;
    }

    .modal {
      position: fixed;
      top: 50%;
      left: 50%;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 999;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.3s ease;
    }

    .modal.show {
      opacity: 1;
      pointer-events: all;
    }

    .modal-content {
      background-color: #fff5f8;
      padding: 20px 30px;
      border-radius: 12px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
      text-align: center;
      min-width: 280px;
      max-width: 90vw;
      transform: scale(0.8);
      transition: transform 0.3s ease;
    }

    .modal.show .modal-content {
      transform: scale(1);
    }
  </style>
</head>
<body>
<h1>小狗抽取你的专属任务</h1>
<div id="card-container"></div>
<p id="status">卡牌任务已显示，请耐心等待洗牌呢...</p>
<div class="button-group">
  <button id="reset-button">重新抽取</button>
  <button id="challenge-button">觉得不够刺激？点我试试看！</button>
  <button id="mild-button">想缓一缓？换回温柔任务</button>
</div>

<div id="password-modal" class="modal hidden">
  <div class="modal-content">
    <p>请输入口令以解锁刺激任务：</p>
    <input type="text" id="password-input" placeholder="请输入口令">
    <div id="password-error" style="color: red; margin-top: 8px; display: none;">口令错误哦～再想想看！</div>
    <div style="margin-top: 15px;">
      <button id="confirm-password">确认</button>
      <button id="cancel-password">取消</button>
    </div>
  </div>
</div>
<script>
  const taskPoolA = [
    "完成一项运动挑战", "学习一个新单词", "写一篇日记",
    "帮助他人完成小任务", "整理桌面", "尝试新菜谱",
    "看一部浪漫电影", "写一封感谢信", "散步30分钟", "尝试新爱好"
  ];

  const taskPoolB = [
    "在公共场合跳舞15秒", "给暗恋对象发消息", "模仿偶像唱一段歌",
    "大胆穿搭出门拍照", "在社交平台发一句土味情话", "挑战辣到爆的食物",
    "录制一段“沙雕”视频发给朋友", "三分钟自我推销演讲", "赤脚走在公园草地上", "给自己写一封大胆告白信"
  ];

  const CARD_COUNT = 10;
  const cardContainer = document.getElementById('card-container');
  const status = document.getElementById('status');
  const resetButton = document.getElementById('reset-button');
  const challengeButton = document.getElementById('challenge-button');
  const mildButton = document.getElementById('mild-button');

  let currentTaskPool = taskPoolA;
  let cards = [];
  let previousTasks = [];

  function getRandomTasks(taskList, count, excludeList = []) {
    const filtered = taskList.filter(task => !excludeList.includes(task));
    if (filtered.length < count) {
      throw new Error('任务数量不足');
    }
    const shuffled = [...filtered];
    for (let i = shuffled.length - 1; i > 0; i--) {
      const j = Math.floor(Math.random() * (i + 1));
      [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
    }
    return shuffled.slice(0, count);
  }

  function initCards(taskPool) {
    cardContainer.innerHTML = '';
    cards = [];
    const selectedTasks = getRandomTasks(taskPool, CARD_COUNT, previousTasks);
    previousTasks = selectedTasks;

    const cols = 5;
    const gapX = 150;
    const gapY = 230;
    const centerX = cardContainer.clientWidth / 2;
    const centerY = cardContainer.clientHeight / 2;
    const startX = centerX - (cols - 1) * gapX / 2;
    const startY = centerY - Math.floor((CARD_COUNT - 1) / cols) * gapY / 2;

    selectedTasks.forEach((task, index) => {
      const card = document.createElement('div');
      card.classList.add('card');
      card.dataset.task = task;
      card.innerHTML = `
        <div class="card-front">${task}</div>
        <div class="card-back">?</div>
      `;
      const col = index % cols;
      const row = Math.floor(index / cols);
      const x = startX + col * gapX - 60;
      const y = startY + row * gapY - 105;
      card.style.left = `${x}px`;
      card.style.top = `${y}px`;
      card.style.transform = `rotateY(0deg)`;
      cardContainer.appendChild(card);
      cards.push(card);
    });

    resetButton.style.display = 'none';
    status.textContent = '本次任务已显示，请小狗耐心等待任务打乱呢...';
    setTimeout(() => shuffleCards(), 3000);
  }

  function shuffleArray(array) {
    for (let i = array.length - 1; i > 0; i--) {
      const j = Math.floor(Math.random() * (i + 1));
      [array[i], array[j]] = [array[j], array[i]];
    }
    return array;
  }

  async function shuffleCards() {
    status.textContent = '打乱中...嘟嘟嘟';
    const shuffleTimes = 15;
    const shuffleRadius = 120;
    const centerX = cardContainer.clientWidth / 2;
    const centerY = cardContainer.clientHeight / 2;

    for (let i = 0; i < shuffleTimes; i++) {
      cards.forEach(card => {
        const angle = Math.random() * 2 * Math.PI;
        const r = shuffleRadius * (0.5 + Math.random() * 0.5);
        const x = centerX + r * Math.cos(angle) - 60;
        const y = centerY + r * Math.sin(angle) - 105;
        const rot = (Math.random() * 120) - 60;
        card.style.transition = 'transform 0.3s ease, left 0.3s ease, top 0.3s ease';
        card.style.left = `${x}px`;
        card.style.top = `${y}px`;
        card.style.transform = `rotate(${rot}deg) rotateY(0deg)`;
        card.style.pointerEvents = 'none';
      });
      await new Promise(r => setTimeout(r, 300));
    }

    const cols = 5;
    const gapX = 150;
    const gapY = 230;
    const startX = centerX - (cols - 1) * gapX / 2;
    const startY = centerY - Math.floor((CARD_COUNT - 1) / cols) * gapY / 2;

    const shuffledCards = shuffleArray([...cards]);
    cardContainer.innerHTML = '';
    shuffledCards.forEach((card, idx) => {
      const col = idx % cols;
      const row = Math.floor(idx / cols);
      const x = startX + col * gapX - 60;
      const y = startY + row * gapY - 105;
      card.classList.add('flipped');
      card.style.transition = 'transform 0.5s ease, left 0.5s ease, top 0.5s ease';
      card.style.left = `${x}px`;
      card.style.top = `${y}px`;
      card.style.transform = `rotateY(180deg)`;
      card.style.pointerEvents = 'auto';
      cardContainer.appendChild(card);
    });
    cards = shuffledCards;
    status.textContent = '洗牌完成咯，小狗抽取一张你的专属牌吧！';
    enableCardSelection();
  }

  function enableCardSelection() {
    cards.forEach(card => {
      card.addEventListener('click', () => {
        if (!card.classList.contains('flipped')) return;
        card.classList.remove('flipped');
        card.style.transition = 'transform 0.6s ease';
        card.style.transform = `rotateY(0deg)`;
        card.style.zIndex = '3';
        status.textContent = `你抽到的任务是：${card.dataset.task}`;
        cards.forEach(c => c.style.pointerEvents = 'none');
        resetButton.style.display = 'block';
      }, { once: true });
    });
  }
  function setActiveButton(activeBtn) {
    [challengeButton, mildButton].forEach(btn => {
      if (btn === activeBtn) {
        btn.classList.add('active');
      } else {
        btn.classList.remove('active');
      }
    });
  }
  // c
  const modal = document.getElementById('password-modal');
  const confirmPassword = document.getElementById('confirm-password');
  const cancelPassword = document.getElementById('cancel-password');
  const passwordInput = document.getElementById('password-input');
  const passwordError = document.getElementById('password-error');

  const correctPassword = '小狗想要'; // 你自定义的口令

  challengeButton.addEventListener('click', function () {
    if (this.classList.contains('active')) return;
    passwordError.style.display = 'none';
    passwordInput.value = '';
    modal.classList.remove('hidden');
    setTimeout(() => modal.classList.add('show'), 10);
  });

  cancelPassword.addEventListener('click', () => {
    modal.classList.remove('show');
    setTimeout(() => modal.classList.add('hidden'), 300);
  });

  confirmPassword.addEventListener('click', () => {
    const entered = passwordInput.value.trim();
    if (entered === correctPassword) {
      passwordError.style.display = 'none';
      modal.classList.remove('show');
      setTimeout(() => modal.classList.add('hidden'), 300);
      currentTaskPool = taskPoolB;
      setActiveButton(challengeButton); // 添加这行
      initCards(currentTaskPool);
      passwordInput.value = '';
    } else {
      passwordError.style.display = 'block';
    }
  });
  window.onload = () => {
    setActiveButton(mildButton);
    initCards(currentTaskPool);
    resetButton.addEventListener('click', () => {
      initCards(currentTaskPool);
    });
    // challengeButton.addEventListener('click', () => {
    //   document.getElementById('password-modal').style.display = 'block';
    //   document.getElementById('password-input').value = '';
    //   document.getElementById('password-error').style.display = 'none';
    // });
    mildButton.addEventListener('click', function () {
      if (this.classList.contains('active')) return;
      currentTaskPool = taskPoolA;
      setActiveButton(mildButton);
      initCards(currentTaskPool);
    });
  };
</script>
</body>
</html>